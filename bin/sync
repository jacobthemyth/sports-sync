#!/usr/bin/env node
var request = require('request');
var _ = require('underscore');

var Firebase = require('firebase');
var ref = new Firebase('http://sportsproject.firebaseio.com');
//
var allGamesURL = 'https://www.kimonolabs.com/api/aubt5o1k?apikey=kImHEUcaMlxMzi9OunQSth2GLHvtWyCl';
var specificURL = "https://www.kimonolabs.com/api/34hkhdqk?apikey=kImHEUcaMlxMzi9OunQSth2GLHvtWyCl";

var gameList = [];

function getGameList()
{
  request(allGamesURL, function (error, response, body) {
    if(!error && response.statusCode == 200) {

      var data = body;
      var parsed = JSON.parse(data);
      gameList = parsed.results.collection1;

      if(gameList.length > 0)
      {
        var g = gameList.shift();
        getGameData(g);
      }

    } else {
      console.log('Error',error);
    }
  })
}

function getGameData(game) {
  var url = game.href.href;
  var splitUrl = "http://sports.yahoo.com/ncaaf/";
  var splitArray = url.split(splitUrl);
  var endPoint = (splitArray[1]);
  var parameter = "&kimpath2=" + endPoint;
  console.log('Sending request for: ' + specificURL + parameter);
  request(specificURL + parameter, function (error, response, body) {
    if (!error && response.statusCode ==200) {
      console.log(body);
    } else {
      console.log(error);
    }

    if (gameList.length > 0) {
    var newData = gameList.shift();
    setTimeout(function () {
      getGameData(newData)
    },5000)
    } else {
      getGameList();
    }
  })

}
getGameList();
